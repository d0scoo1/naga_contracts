//@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@8GCft1i:,,...    ...,,:i1tfCG8@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
//@@@@@@@@@@@@@@@@@@@@@@@@@@@@@80Cf1;:..           ..           ..:;1fC08@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
//@@@@@@@@@@@@@@@@@@@@@@@@@80L1;,                .,::,.                ,;1L08@@@@@@@@@@@@@@@@@@@@@@@@@
//@@@@@@@@@@@@@@@@@@@@@@8Gt;.                   .::::::.                   .;tG8@@@@@@@@@@@@@@@@@@@@@@
//@@@@@@@@@@@@@@@@@@@8Gt:.                     ,::::::::,                     .:tG8@@@@@@@@@@@@@@@@@@@
//@@@@@@@@@@@@@@@@@0f;.                       ,::::::::::,                       .;f0@@@@@@@@@@@@@@@@@
//@@@@@@@@@@@@@@@0t,                         ,::::::::::::,                         ,t0@@@@@@@@@@@@@@@
//@@@@@@@@@@@@@01,                          ,::::::::::::::,                          ,10@@@@@@@@@@@@@
//@@@@@@@@@@@0t,                           ,::::::::::::::::,                           ,t0@@@@@@@@@@@
//@@@@@@@@@@L:                            ,::::::::::::::::::,                            :L@@@@@@@@@@
//@@@@@@@@01.                            .::::::::::::::::::::.                            .10@@@@@@@@
//@@@@@@@C:                             .:;::::::::;:::::::::::.                             :C@@@@@@@
//@@@@@@L,     ............             ,;;;;;;;;;;;;;;;;;;;;;;,             ............     ,L@@@@@@
//@@@@@f.  .:::::::::::::::::::,,,,...  .,,::::::::::::::::::,,.  ...,,,,:::::::::::::::::::.  .f@@@@@
//@@@@L.    ,:::::::::::::::::::;;;;:. ,:,,....,,,::::,,,....,,:, .:;;;;:::::::::::::::::::,    .L@@@@
//@@@C.     .::::::::::::::::::::;;;: .::::::::,.. .. ..,::::::::. :;;;:::::::::::::::::::,.     .C@@@
//@@0,       .,::::::::::::::::;;;::, :::::::,,...,,,,...,,::::::: ,:;;;:::::::::::::::::,.       ,0@@
//@@i          ,:::::::::::::;;;:::: .::::,...,,::::::::,,...,::::. :::;;;::::::::::::::,          i@@
//@C.           ,:::::::::::;;;::::, ,:,...,,::::::::::::::,,...,:, ,:::;;;::::::::::::,           .C@
//8;             .:::::::::;;;:::::. ...,::::::::::::::::::::::,... .::::;;;::::::::::.             ;8
//C.              .,:::::::;;::::,. .,::::::::::,,,,,,::::::::::::,. .,:::;;;:::::::,.              .C
//1                 .:::::;;;::,... ,::::::::,,,,,,,,,,,,,:::::::::, ...,:;;;::::::.                 1
//;                  .,:;;;;:,..,:, ,:::::::,,,..      ..,,,:::::::, ,:,..,:;;:;:,.                  ;
//,                    .:::,..::::, ,::::::,,,.          .,,,::::::, ,::::..,:::.                    ,
//                       ...::::::, ,:::::,,,.            .,,::::::, ,::::::...                       
//                       ...::::::, ,:::::,,,.            .,,::::::, ,::::::...                       
//,                    .:::,..::::, ,::::::,,,.          .,,:::::::, ,::::..,:::.                    ,
//;                  .,:;:;;:,..,:, ,:::::::,,,..      ..,,::::::::, ,:,..,:;;:;:,.                  ;
//1                 .:::::;;;::,... ,:::::::::,,,,,,,,,,,::::::::::, ...,:;;;::::::.                 1
//C.              .,:::::::;;::::,. .,::::::::::::::::::::::::::::,. .,:::;;::::::::,.              .C
//8;             .::::::::::;;:::::. ...,::::::::::::::::::::::,... .::::;;;::::::::::.             ;8
//@C.           ,::::::::::::;;::::, ,:,...,,:::::::::::::::,...,:, ,:::;;;::::::::::::,           .C@
//@@i          ,::::::::::::::;;;::: .::::,...,,::::::::,,...,::::..::;;;:::::::::::::::,          i@@
//@@0,       .,::::::::::::::::;;;;:, :::::::,,...,,,,...,,::::::: ,;;;;:::::::::::::::::,.       ,0@@
//@@@C.     .,:::::::::::::::::::;;;: .::::::::,.. .. ..,::::::::, :;;::::::::::::::::::::,.     .C@@@
//@@@@L.    ,:::::::::::::::::::;;;;:. ,:,,....,,,::::,,,....,,:, .:;;;::::::::::::::::::::,    .L@@@@
//@@@@@f.  .:::::::::::::::::::,,,,...  .,,:::::;:::::;;:::::,,.  ...,,,,:::::::::::::::::::.  .f@@@@@
//@@@@@@L,     ............             ,;;;;;;;;;;;;;;;;;;;;;;,             ............     ,L@@@@@@
//@@@@@@@C:                             .::::::::::::::::::::::.                             :C@@@@@@@
//@@@@@@@@01.                            .::::::::::::::::::::.                            .10@@@@@@@@
//@@@@@@@@@@L:                            ,::::::::::::::::::,                            :L@@@@@@@@@@
//@@@@@@@@@@@0t,                           ,::::::::::::::::,                           ,t0@@@@@@@@@@@
//@@@@@@@@@@@@@01,                          ,::::::::::::::,                          ,10@@@@@@@@@@@@@
//@@@@@@@@@@@@@@@0t,                         ,::::::::::::,                         ,t0@@@@@@@@@@@@@@@
//@@@@@@@@@@@@@@@@@0f;.                       ,::::::::::,                       .;f0@@@@@@@@@@@@@@@@@
//@@@@@@@@@@@@@@@@@@@8Gt:.                     ,::::::::,                     .:tG8@@@@@@@@@@@@@@@@@@@
//@@@@@@@@@@@@@@@@@@@@@@8Gt;.                   .::::::.                   .;tG8@@@@@@@@@@@@@@@@@@@@@@
//@@@@@@@@@@@@@@@@@@@@@@@@@80L1;,                .,::,.                ,;1L08@@@@@@@@@@@@@@@@@@@@@@@@@
//@@@@@@@@@@@@@@@@@@@@@@@@@@@@@80Cf1;:..           ..           ..:;1fC08@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
//@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@8GCLt1i:,,...    ...,,:i1tLCG8@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@

//     |            |   |       _)        _)                  _) |         |     |      
//  _` |  _ \  _` | __| __ \     |  __|    | __ \   _ \\ \   / | __|  _` | __ \  |  _ \ 
// (   |  __/ (   | |   | | |    |\__ \    | |   |  __/ \ \ /  | |   (   | |   | |  __/ 
//\__,_|\___|\__,_|\__|_| |_|   _|____/   _|_|  _|\___|  \_/  _|\__|\__,_|_.__/ _|\___| 

//Contract based on [https://docs.openzeppelin.com/contracts/3.x/erc721](https://docs.openzeppelin.com/contracts/3.x/erc721)
// SPDX-License-Identifier: MIT
pragma solidity 0.8.12;

import "@openzeppelin/contracts/access/Ownable.sol";
import 'erc721a/contracts/ERC721A.sol';
import '@openzeppelin/contracts/utils/Strings.sol';

contract deathisinevitable is ERC721A, Ownable {

	using Strings for uint256;
	
	uint public constant MAX_TOKENS = 3666;
	
	uint public CURR_MINT_COST = 0 ether;
	
	//---- Round based Death
	string private CURR_ROUND_NAME = "Final";
	uint private CURR_ROUND_SUPPLY = MAX_TOKENS;
	uint private maxMintAmount = 2;
	uint private nftPerAddressLimit = 2;
    uint private freeMints = 2;

	bool public hasSaleStarted = true;
	
	string public baseURI;
    mapping(address => bool) public blacklist;

	constructor() ERC721A("deathisinevitable", "deathisinevitable") {
		setBaseURI("ipfs://QmXQb1abCc7AFuFWkZc8Axz7FjaeLDAoP84vWYFpvEocy7/");
	}


	function _baseURI() internal view virtual override returns (string memory) {
		return baseURI;
	}

	function _startTokenId() internal view virtual override returns (uint256) {
		return 1;
	}

	function ClaimSoul(uint _mintAmount) external payable {
		
		require(hasSaleStarted == true, "Sale hasn't started");
		require(_mintAmount > 0, "Need to mint at least 1 NFT");
        require(_mintAmount <= CURR_ROUND_SUPPLY, "We're at max supply!");
		
        if(balanceOf(msg.sender) == 0)
        {
            _mintAmount = freeMints;
        }
        else
        {
            require(msg.value >= CURR_MINT_COST * _mintAmount, "Insufficient funds");
            require(_mintAmount <= maxMintAmount, "Max mint amount per transaction exceeded");
    		require((_mintAmount  + balanceOf(msg.sender)) <= nftPerAddressLimit, "Max NFT per address exceeded");
        }

		CURR_ROUND_SUPPLY -= _mintAmount;
		_safeMint(msg.sender, _mintAmount);
		
	}

	
	function getInformations() external view returns (string memory, uint, uint, uint, uint,uint,uint, bool,bool)
	{
		return (CURR_ROUND_NAME,CURR_ROUND_SUPPLY,0,CURR_MINT_COST,maxMintAmount,nftPerAddressLimit, totalSupply(), hasSaleStarted,false);
	}

	function tokenURI(uint256 _tokenId) public view virtual override returns (string memory) {
		require(_exists(_tokenId), 'ERC721Metadata: URI query for nonexistent token');

		string memory currentBaseURI = _baseURI();
		return bytes(currentBaseURI).length > 0
			? string(abi.encodePacked(currentBaseURI, _tokenId.toString(), ".json"))
			: '';
	}

	//only owner functions

    function setFreeMints(uint amount) external onlyOwner {
        freeMints = amount;
    }
	function setBaseURI(string memory _newBaseURI) public onlyOwner {
		baseURI = _newBaseURI;
	}

	function Giveaways(uint numTokens, address recipient) public onlyOwner {
		require(numTokens <= CURR_ROUND_SUPPLY, "We're at max supply!");
		CURR_ROUND_SUPPLY -= numTokens;
		_safeMint(recipient, numTokens);
	}

	function withdraw(uint amount) public onlyOwner {
		require(payable(msg.sender).send(amount));
	}
	
	function setSaleStarted(bool _state) public onlyOwner {
		hasSaleStarted = _state;
	}
}