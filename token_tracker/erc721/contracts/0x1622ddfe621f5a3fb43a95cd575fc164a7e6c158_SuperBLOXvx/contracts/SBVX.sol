/* SPDX-License-Identifier: MIT
SuperBLOXvx by NounPunks



NMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMN
NMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMN
NMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMN
NMMMMMMMMMMMMMMWXOOOOOOOOOOOOOOOO0NMWXOOOOOOOOO0NMMXOO0NMMXOOOOOOOOOOOOOOOO0NMMXOOOOOOOOOOOOOOOOO0NMMXOOOOOOOOOOOOOOOO0NMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMN
NMMMMMMMMMMMMMMNo................,OMNo.........,0MWd..,OMWd................,OMWd.................'OMWx................'kMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMN
NMMMMMMMMMMMMMMNl..........:llllldXMNl.........,OMWo. 'OMWo..........;ll,..'OMWd......... .;llllldKMWd..........;ll;. .kMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMN
NMMMMMMMMMMMMMMNl........ ,OWWWWWWMMNl........ 'OMWo. 'OMWo.........'kWNo. 'OMWd........  'kWWMMMMMMWd........ .kWWd...kMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMN
NMMMMMMMMMMMMMMNl..........;cc:c:oKMNo........ 'OMWo. 'OMWo..........,c:'. 'OMWd...........,:cxNMMMMWd. ........,::ldxkXMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMN
NMMMMMMMMMMMMMMWo............... 'OMNo........ 'OMWo. 'OMWo................;OMWd..............lNMMMMWd. ...........:0XXWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMN
NMMMMMMMMMMMMMMMN00000O:.........'OMNl........ 'OMWo. 'OMWo........ .o0K000KNMWd........  .o00XWMMMMWd....... ......'';OMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMN
NMMMMMMMMMMMMMMWXOOOOOk:.........,OMNl........ .oOk:. 'OMWo........ 'kMMMMMMMMWd......... .oOOOOO0NMWd.......,,,..... .kMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMN
NMMMMMMMMMMMMMMNo........ ...... 'OMNl........ .....  'OMWo. ...... 'kMMMMMMMMWd. ...............,OMWd. ....:KN0;   ...kMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMN
NMMMMMMMMMMMMMMWOlllllllllllllllldXMWOlllllllllllllllldKMWOllllllllldKMMMMMMMMW0llllllllllllllllloKMW0olllllkNMNxllllloKMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMN
NMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMN
NMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMN
NMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWNNNNNNNNNNNWWWWWWMMMWNNNNNNNNNNWMMMMMMMMMWNNNNNNNNNNNNNNWWWWWMMWNNNNNNWMMWNNNNNNNWMMWNNNNNNNNNNWMMWNNNWMMWNNNNNNNMMMWNNNNNNWMMMMMMMMMMMMMMMN
NMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWx,,,,,,,,,,;;;;;;lKMWk;,,,,,,,,:0MMMMMMMMW0dooooooooooooooooxKMWk;,,,,,dNMXo,,,,,:OMMO;,,,,,,,,:OMMO:,;OMMO;,,,,,oXMNo,,,,,;OMMMMMMMMMMMMMMMN
NMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMNl..........',,.. 'OMWo.........'OMMMMMMMMWOc:;;,,,,,,;cooc::l0WWd......;k0x,.... .kMWx........ .kMMx. .xWWx. ....,x0x;.... .xWMMMMMMMMMMMMMMN
NMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMNo........ 'kNXl. 'OMWo.........'OMMMMMMMMWOc:,.......'xNNkc:l0MWd............... .kMWx..........kMWx. .xMWx.  ............ .xWMMMMMMMMMMMMMMN
NMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMNo..........cxd;. 'OMWo.........'OMMMMMMMMWOc:,.....  'kMWOc:l0WW0lc:...........:co0MWx........ .xMMx. .xMM0lc:...........:cl0MMMMMMMMMMMMMMMN
NMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMNo................'OMWo........ 'OMMMMMMMMWOc:,.....  'kMWOc:l0WMMWMK;.........cXMWMMWx........ .xMMx. .xWMMWWK:.........;KWWMMMMMMMMMMMMMMMMN
NMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMNo..........cdo;. 'OMWo........ 'OMMMMMMMMWOc:,...... 'kMWOc:l0MM0ol:..........'cloKMWx........ .xMMx. .xWM0ol:...........:lo0MMMMMMMMMMMMMMMN
NMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMNo.........'kNXl. 'OMWo.........'xNNNNNWWMWOc:;.......'kWNkc:l0MWd. ............. .kMWx'.........dNNx'.'kWMx. ............. .xWMMMMMMMMMMMMMMN
NMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMNo..........';,.. 'OMWo..........';;;;,c0MWOc:;,,,,,,,;cool::l0WWd......;kOx,.... .kMMN00k;......',;lO00NMWx......,x0x,......xWMMMMMMMMMMMMMMN
NMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWd,''''''''''''''':0MWx,''''''''''''''':0MW0olllllllllllllllldKMWk,'''''oNMXl''''';OMMMMMNo'''''''''oNMMMMMk;'''''lXMXo''''';kMMMMMMMMMMMMMMMN
NMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMNXXXXXXXXXXXXXXXXNWMMNXXXXXXXXXXXXXXXXNWMMWNNNNNNNNNNNNNNNNNNWMMWXXXXXXNMMWNXXXXXXWMMMMMWNXXXXXXXXXNMMMMMMWXXXXXXNWMMNXXXXXXWMMMMMMMMMMMMMMMN
NMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMN
NMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMN
NMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMN*/


pragma solidity 0.8.9;
import "erc721a/contracts/ERC721A.sol";
import "@openzeppelin/contracts/access/Ownable.sol";

contract SuperBLOXvx is ERC721A, Ownable {
    using Strings for uint256;

    uint256 public MAX_SUPPLY = 9969;
    uint256 public MINT_COST = 0.089 ether;
    uint256 public LOYALTY_MINT_COST = 0.05 ether;
    uint256 adCount = 1;

    string public uriPrefix = "";
    string public uriSuffix = ".json";
    string public hiddenMetadataUri;

    address public sbContract = 0x9eAE2e033dAe8573f53617125967f963AF96984C;
    address public npContract = 0xE169c2ED585e62B1d32615BF2591093A629549b6;
    address [] loyaltyMintList;

    bool public saleIsActive;
    bool public loyaltyMintIsActive;
    bool public revealed;

    constructor() ERC721A("superBLOXvx", "SBVX") {
        saleIsActive = false;
        loyaltyMintIsActive = false;
        revealed = false;
    }

    function mint(uint256 _mintAmount) public payable {
        require(saleIsActive, "Sale not active.");
        require(totalSupply() + _mintAmount <= MAX_SUPPLY, "Not enough SuperBLOXvx remaining.");
        require(msg.value >= MINT_COST * _mintAmount, "Not enough ETH for requested amount.");
  
        _safeMint(msg.sender, _mintAmount);

    }

    function loyaltyMint(uint256 _mintAmount) public payable {
        ERC721A _sbContract = ERC721A(sbContract);
        ERC721A _npContract = ERC721A(npContract);

        require(loyaltyMintIsActive, "Loyalty mint not active.");
        require(_sbContract.balanceOf(msg.sender) > 0 || _npContract.balanceOf(msg.sender) > 0);
        require(hasLoyaltyMinted(msg.sender) == false);
        require(_mintAmount <= 5);
        require(totalSupply() + _mintAmount <= MAX_SUPPLY, "Not enough tokSuperBLOXvxens remaining.");
        require(msg.value >= LOYALTY_MINT_COST * _mintAmount, "Not enough ETH for requested amount.");

        _safeMint(msg.sender, _mintAmount);        
        loyaltyMintList.push(msg.sender);
    }

    function hasLoyaltyMinted(address _address) public view returns (bool _hasLoyaltyMinted) {
        uint i;
    
        for(i = 0; i < loyaltyMintList.length; i++) {
            if(loyaltyMintList[i] == _address) {
                return true;
            }
        }
    
        if(i >= loyaltyMintList.length)
            return false;
    }

    function devMintToSelf(uint256 _mintAmount) public onlyOwner {
        require(totalSupply() + _mintAmount <= MAX_SUPPLY, "Not enough SuperBLOXvx remaining.");
        
        _safeMint(msg.sender, _mintAmount);
    }

    function devMintToAddress(uint256 _mintAmount, address _receiver) public onlyOwner {
        require(totalSupply() + _mintAmount <= MAX_SUPPLY, "Not enough SuperBLOXvx remaining.");
        
        _safeMint(_receiver, _mintAmount);
        
    }

    function airdropSB(uint256 _qty) public onlyOwner {
                
        ERC721A _sbContract = ERC721A(sbContract);
        
        for(uint256 i = 0; i < _qty; i++) {
        _safeMint(_sbContract.ownerOf(adCount),1);
        adCount = adCount + 1;
        }

    }

    function setSbContract(address _sbContract) public onlyOwner {
        sbContract = _sbContract;
    }

    function setNpContract(address _npContract) public onlyOwner {
        npContract = _npContract;
    }

    function setAdCount(uint256 _adCount) public onlyOwner {
        adCount = _adCount;
    }

    function setMintCost(uint256 _newMintCost) public onlyOwner {
        MINT_COST = _newMintCost;
    }
 
    function setMaxSupply(uint256 _newMaxSupply) public onlyOwner {
        require(_newMaxSupply < MAX_SUPPLY);
        MAX_SUPPLY = _newMaxSupply;
    }

    function toggleSale() public onlyOwner {
        saleIsActive = !saleIsActive;
    }

    function toggleLoyaltyMint() public onlyOwner {
        loyaltyMintIsActive = !loyaltyMintIsActive;
    }

    function toggleRevealed() public onlyOwner {
        revealed = !revealed;
    }

    function _startTokenId() internal view virtual override returns (uint256) {
        return 1;
    }

    function _baseURI() internal view virtual override returns (string memory) {
        return uriPrefix;
    }

    function setUriPrefix(string memory _uriPrefix) public onlyOwner {
        uriPrefix = _uriPrefix;
    }

    function setUriSuffix(string memory _uriSuffix) public onlyOwner {
        uriSuffix = _uriSuffix;
    }

    function setHiddenMetadataUri(string memory _hiddenMetadataUri) public onlyOwner {
        hiddenMetadataUri = _hiddenMetadataUri;
    }

    function tokenURI(uint256 _tokenId) public view virtual override returns (string memory) {
        require(_exists(_tokenId), "ERC721Metadata: URI query for nonexistent token");

        if (revealed == false) {
            return hiddenMetadataUri;
        }

        string memory currentBaseURI = _baseURI();
        return bytes(currentBaseURI).length > 0 ? string(abi.encodePacked(currentBaseURI, _tokenId.toString(), uriSuffix)) : "";
    }

    function withdrawBalance() public onlyOwner {
        payable(msg.sender).transfer(address(this).balance);
    }
    
}