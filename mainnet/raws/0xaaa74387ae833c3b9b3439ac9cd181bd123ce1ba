{"status": "1", "message": "OK", "result": [{"SourceCode": "pragma solidity 0.8.7;\r\n\r\n\r\n// SPDX-License-Identifier: MIT\r\n/**\r\n * @dev String operations.\r\n */\r\nlibrary Strings {\r\n    bytes16 private constant _HEX_SYMBOLS = \"0123456789abcdef\";\r\n\r\n    /**\r\n     * @dev Converts a `uint256` to its ASCII `string` decimal representation.\r\n     */\r\n    function toString(uint256 value) internal pure returns (string memory) {\r\n        // Inspired by OraclizeAPI's implementation - MIT licence\r\n        // https://github.com/oraclize/ethereum-api/blob/b42146b063c7d6ee1358846c198246239e9360e8/oraclizeAPI_0.4.25.sol\r\n\r\n        if (value == 0) {\r\n            return \"0\";\r\n        }\r\n        uint256 temp = value;\r\n        uint256 digits;\r\n        while (temp != 0) {\r\n            digits++;\r\n            temp /= 10;\r\n        }\r\n        bytes memory buffer = new bytes(digits);\r\n        while (value != 0) {\r\n            digits -= 1;\r\n            buffer[digits] = bytes1(uint8(48 + uint256(value % 10)));\r\n            value /= 10;\r\n        }\r\n        return string(buffer);\r\n    }\r\n\r\n    /**\r\n     * @dev Converts a `uint256` to its ASCII `string` hexadecimal representation.\r\n     */\r\n    function toHexString(uint256 value) internal pure returns (string memory) {\r\n        if (value == 0) {\r\n            return \"0x00\";\r\n        }\r\n        uint256 temp = value;\r\n        uint256 length = 0;\r\n        while (temp != 0) {\r\n            length++;\r\n            temp >>= 8;\r\n        }\r\n        return toHexString(value, length);\r\n    }\r\n\r\n    /**\r\n     * @dev Converts a `uint256` to its ASCII `string` hexadecimal representation with fixed length.\r\n     */\r\n    function toHexString(uint256 value, uint256 length) internal pure returns (string memory) {\r\n        bytes memory buffer = new bytes(2 * length + 2);\r\n        buffer[0] = \"0\";\r\n        buffer[1] = \"x\";\r\n        for (uint256 i = 2 * length + 1; i > 1; --i) {\r\n            buffer[i] = _HEX_SYMBOLS[value & 0xf];\r\n            value >>= 4;\r\n        }\r\n        require(value == 0, \"Strings: hex length insufficient\");\r\n        return string(buffer);\r\n    }\r\n}\r\n\r\ninterface ITraits {\r\n  function tokenURI(uint256 tokenId) external view returns (string memory);\r\n  function tokenURINotRevealed(uint256 tokenId) external view returns (string memory);\r\n  function tokenURITopTalents(uint8 topTalentNo, uint256 tokenId) external view returns (string memory);\r\n}\r\n\r\ninterface IDrawSvg {\r\n  function drawSvg(\r\n    string memory svgBreedColor, string memory svgBreedHead, string memory svgOffhand, string memory svgArmor, string memory svgMainhand\r\n  ) external view returns (string memory);\r\n  function drawSvgNew(\r\n    string memory svgBreedColor, string memory svgBreedHead, string memory svgOffhand, string memory svgArmor, string memory svgMainhand\r\n  ) external view returns (string memory);\r\n}\r\n\r\ninterface INameChange {\r\n  function changeName(address owner, uint256 id, string memory newName) external;\r\n}\r\n\r\ninterface IDogewood {\r\n    // struct to store each token's traits\r\n    struct Doge2 {\r\n        uint8 head;\r\n        uint8 breed;\r\n        uint8 color;\r\n        uint8 class;\r\n        uint8 armor;\r\n        uint8 offhand;\r\n        uint8 mainhand;\r\n        uint16 level;\r\n        uint16 breedRerollCount;\r\n        uint16 classRerollCount;\r\n        uint8 artStyle; // 0: new, 1: old\r\n    }\r\n\r\n    function getTokenTraits(uint256 tokenId) external view returns (Doge2 memory);\r\n    function getGenesisSupply() external view returns (uint256);\r\n    function validateOwnerOfDoge(uint256 id, address who_) external view returns (bool);\r\n    function unstakeForQuest(address[] memory owners, uint256[] memory ids) external;\r\n    function updateQuestCooldown(uint256[] memory doges, uint88 timestamp) external;\r\n    function pull(address owner, uint256[] calldata ids) external;\r\n    function manuallyAdjustDoge(uint256 id, uint8 head, uint8 breed, uint8 color, uint8 class, uint8 armor, uint8 offhand, uint8 mainhand, uint16 level, uint16 breedRerollCount, uint16 classRerollCount, uint8 artStyle) external;\r\n    function transfer(address to, uint256 tokenId) external;\r\n    // function doges(uint256 id) external view returns(uint8 head, uint8 breed, uint8 color, uint8 class, uint8 armor, uint8 offhand, uint8 mainhand, uint16 level);\r\n}\r\n\r\ninterface IDogewoodForCommonerSale {\r\n    function validateDogeOwnerForClaim(uint256 id, address who_) external view returns (bool);\r\n}\r\n\r\ninterface ICastleForCommonerSale {\r\n    function dogeOwner(uint256 id) external view returns (address);\r\n}\r\n\r\n// interface DogeLike {\r\n//     function pull(address owner, uint256[] calldata ids) external;\r\n//     function manuallyAdjustDoge(uint256 id, uint8 head, uint8 breed, uint8 color, uint8 class, uint8 armor, uint8 offhand, uint8 mainhand, uint16 level) external;\r\n//     function transfer(address to, uint256 tokenId) external;\r\n//     function doges(uint256 id) external view returns(uint8 head, uint8 breed, uint8 color, uint8 class, uint8 armor, uint8 offhand, uint8 mainhand, uint16 level);\r\n// }\r\ninterface PortalLike {\r\n    function sendMessage(bytes calldata message_) external;\r\n}\r\n\r\ninterface CastleLike {\r\n    function pullCallback(address owner, uint256[] calldata ids) external;\r\n}\r\n\r\ninterface ERC20Like {\r\n    function balanceOf(address from) external view returns(uint256 balance);\r\n    function burn(address from, uint256 amount) external;\r\n    function mint(address from, uint256 amount) external;\r\n    function transfer(address to, uint256 amount) external;\r\n    function transferFrom(address from, address to, uint256 value) external;\r\n}\r\n\r\ninterface ERC1155Like {\r\n    function mint(address to, uint256 id, uint256 amount) external;\r\n    function burn(address from, uint256 id, uint256 amount) external;\r\n}\r\n\r\ninterface ERC721Like {\r\n    function transferFrom(address from, address to, uint256 id) external;   \r\n    function transfer(address to, uint256 id) external;\r\n    function ownerOf(uint256 id) external returns (address owner);\r\n    function mint(address to, uint256 tokenid) external;\r\n}\r\n\r\ninterface QuestLike {\r\n    struct GroupConfig {\r\n        uint16 lvlFrom;\r\n        uint16 lvlTo;\r\n        uint256 entryFee; // additional entry $TREAT\r\n        uint256 initPrize; // init prize pool $TREAT\r\n    }\r\n    struct Action {\r\n        uint256 id; // unique id to distinguish activities\r\n        uint88 timestamp;\r\n        uint256 doge;\r\n        address owner;\r\n        uint256 score;\r\n        uint256 finalScore;\r\n    }\r\n\r\n    function doQuestByAdmin(uint256 doge, address owner, uint256 score, uint8 groupIndex, uint256 combatId) external;\r\n}\r\n\r\ninterface IOracle {\r\n    function request() external returns (uint64 key);\r\n    function getRandom(uint64 id) external view returns(uint256 rand);\r\n}\r\n\r\ninterface IVRF {\r\n    function getRandom(uint256 seed) external returns (uint256);\r\n    function getRandom(string memory seed) external returns (uint256);\r\n    function getRand(uint256 nonce) external view returns (uint256);\r\n    function getRange(uint min, uint max,uint nonce) external view returns(uint);\r\n}\r\n\r\ninterface ICommoner {\r\n    // struct to store each token's traits\r\n    struct Commoner {\r\n        uint8 head;\r\n        uint8 breed;\r\n        uint8 palette;\r\n        uint8 bodyType;\r\n        uint8 clothes;\r\n        uint8 accessory;\r\n        uint8 background;\r\n        uint8 smithing;\r\n        uint8 alchemy;\r\n        uint8 cooking;\r\n    }\r\n\r\n    function getTokenTraits(uint256 tokenId) external view returns (Commoner memory);\r\n    function getGenesisSupply() external view returns (uint256);\r\n    function validateOwner(uint256 id, address who_) external view returns (bool);\r\n    function pull(address owner, uint256[] calldata ids) external;\r\n    function adjust(uint256 id, uint8 head, uint8 breed, uint8 palette, uint8 bodyType, uint8 clothes, uint8 accessory, uint8 background, uint8 smithing, uint8 alchemy, uint8 cooking) external;\r\n    function transfer(address to, uint256 tokenId) external;\r\n}\r\n\r\n// import \"../lib/openzeppelin-contracts/contracts/access/Ownable.sol\";\r\n// import \"@openzeppelin/contracts/access/Ownable.sol\";\r\ncontract TraitsCommoners is ITraits {\r\n\r\n  using Strings for uint256;\r\n\r\n  address implementation_;\r\n  address public admin;\r\n\r\n  bool public revealed;\r\n  string public notRevealedUri;\r\n\r\n  address[4] public sourceTopTalents; // top talents contract address\r\n\r\n  /**\r\n    trait types\r\n    index => name\r\n      ['head', 'breed', 'palette', 'bodyType', 'clothes', 'accessory', 'background', 'smithing', 'alchemy', 'cooking']\r\n   */\r\n  mapping (uint8=>string) public traitTypes;\r\n\r\n  /**\r\n    storage of each traits name\r\n    trait1 => [name1, name2, ...]\r\n      trait1:\r\n        0: head\r\n        1: breed\r\n        2: palette\r\n        3: bodyType\r\n        4: clothes\r\n        5: accessory A (hats A)\r\n        6: accessory B (hats B)\r\n        7: background\r\n   */\r\n  mapping(uint8 => mapping(uint8 => string)) public traitNames;\r\n\r\n  /**\r\n    trait1 => id1 => address\r\n      trait1:\r\n        0: background (background0)\r\n        1: clothes A (clothes0a)\r\n        2: clothes B (clothes0b)\r\n        3: hats A (hat0a)\r\n        4: hats B (hat0b)\r\n   */\r\n  mapping (uint8 => mapping(uint8 => address)) public traitSvgs1;\r\n\r\n  /**\r\n    trait1 => id1 => trait2 => id2 => address\r\n      trait1:\r\n        0: breed (breed0head0a)\r\n      trait2:\r\n        0: head A (breed0head0a)\r\n        1: head B (breed0head0b)\r\n        2: color (breed0color0)\r\n   */\r\n  mapping(uint8 => mapping(uint8 => mapping(uint8 => mapping(uint8 => address)))) public traitSvgs2;\r\n\r\n  ICommoner public commoner;\r\n  \r\n  string internal constant TABLE = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\r\n  \r\n  /*///////////////////////////////////////////////////////////////\r\n                  End of data\r\n  //////////////////////////////////////////////////////////////*/\r\n\r\n  function initialize() external onlyOwner {\r\n    require(msg.sender == admin);\r\n\r\n    string[10] memory traitTypes_ = ['head', 'breed', 'palette', 'bodyType', 'clothes', 'accessory', 'background', 'smithing', 'alchemy', 'cooking'];\r\n    for (uint8 i = 0; i < traitTypes_.length; i++) {\r\n      traitTypes[i] = traitTypes_[i];  \r\n    }\r\n\r\n    // // head\r\n    // string[9] memory heads = [\"Determined\", \"High\", \"Happy\", \"Determined Tongue\", \"High Tongue\", \"Happy Tongue\", \"Determined Open\", \"High Open\", \"Happy Open\"];\r\n    // for (uint8 i = 0; i < heads.length; i++) {\r\n    //   traitNames[0][i] = heads[i];  \r\n    // }\r\n    // // bread\r\n    // string[8] memory breeds = [\"Shiba\", \"Pug\", \"Corgi\", \"Labrador\", \"Dachshund\", \"Poodle\", \"Pitbull\", \"Bulldog\"];\r\n    // for (uint8 i = 0; i < breeds.length; i++) {\r\n    //   traitNames[1][i] = breeds[i];  \r\n    // }\r\n    // // palette\r\n    // string[6] memory palettes = [\"Palette 1\", \"Palette 2\", \"Palette 3\", \"Palette 4\", \"Palette 5\", \"Palette 6\"];\r\n    // for (uint8 i = 0; i < palettes.length; i++) {\r\n    //   traitNames[2][i] = palettes[i];  \r\n    // }\r\n    // // bodyType\r\n    // string[2] memory bodyTypes = [\"A (Male)\", \"B (Female)\"];\r\n    // for (uint8 i = 0; i < bodyTypes.length; i++) {\r\n    //   traitNames[3][i] = bodyTypes[i];  \r\n    // }\r\n    // // clothes\r\n    // string[13] memory clothes = [\"Worker Overalls\", \"Crafter Apron\", \"Jeweled Robes\", \"Leather Shawl\", \"Weaver Attire\", \r\n    //   \"Ceremonial Garments\", \"Peasant Shirt\", \"Spellcaster Robes\", \"Thief Rags\", \"Noble Cape\", \r\n    //   \"Performer Costume\", \"Jaunty Getup\", \"Traveler Garb\"];\r\n    // for (uint8 i = 0; i < clothes.length; i++) {\r\n    //   traitNames[4][i] = clothes[i];  \r\n    // }\r\n\r\n    // // accessory - hats A\r\n    // string[13] memory accessoryA = [\"None\", \"Goggles\", \"Jeweled Cap\", \"Leather Tophat\", \"Weaver Tophat\", \r\n    //   \"Ceremonial Bone\", \"Peasant Cap\", \"Wizard Hat\", \"Thief Bycocket\", \"Noble Bowler\", \r\n    //   \"Costume Mask\", \"Jaunty Hat\", \"Traveler Beret\"];\r\n    // for (uint8 i = 0; i < accessoryA.length; i++) {\r\n    //   traitNames[5][i] = accessoryA[i];  \r\n    // }\r\n    // // accessory - hats B\r\n    // string[13] memory accessoryB = [\"None\", \"Goggles\", \"Jeweler Glasses\", \"Leather Hat\", \"Weaver Tophat\", \r\n    //   \"Ceremonial Bone\", \"Bandana\", \"Witchy Hat\", \"Thief Hat\", \"Noble Bonnet\", \r\n    //   \"Costume Mask\", \"Jaunty Turban\", \"Traveler Bycocket\"];\r\n    // for (uint8 i = 0; i < accessoryB.length; i++) {\r\n    //   traitNames[6][i] = accessoryB[i];  \r\n    // }\r\n\r\n    // // background\r\n    // string[6] memory background = [\"Day Forest\", \"Dogewood Village Square\", \"Night Forest\", \"Home\", \"Deep Forest\", \"Hearth\"];\r\n    // for (uint8 i = 0; i < background.length; i++) {\r\n    //   traitNames[7][i] = background[i];  \r\n    // }\r\n  }\r\n\r\n  modifier onlyOwner() {\r\n      require(msg.sender == admin);\r\n      _;\r\n  }\r\n\r\n  /** ADMIN */\r\n\r\n  function setSourceTopTalents(address[4] memory source_) external onlyOwner {\r\n    for (uint256 i = 0; i < 4; i++) {\r\n      sourceTopTalents[i] = source_[i];\r\n    }\r\n  }\r\n\r\n  function setNotRevealedUri(string memory uri_) external onlyOwner {\r\n    notRevealedUri = uri_;\r\n  }\r\n\r\n  function setRevealed(bool revealed_) external onlyOwner {\r\n    revealed = revealed_;\r\n  }\r\n\r\n  function setCommoner(address _commoner) external onlyOwner {\r\n    commoner = ICommoner(_commoner);\r\n  }\r\n\r\n  function setTraitTypes(uint8[] memory ids_, string[] memory values_) external onlyOwner {\r\n    require(ids_.length == values_.length);\r\n    for (uint256 i = 0; i < ids_.length; i++) {\r\n      traitTypes[ids_[i]] = values_[i];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * administrative to upload the names associated with each trait\r\n   */\r\n  function setTraitNames(uint8 trait, uint8[] calldata traitIds, string[] calldata names) external onlyOwner {\r\n    require(traitIds.length == names.length, \"Mismatched inputs\");\r\n    for (uint256 index = 0; index < traitIds.length; index++) {\r\n      traitNames[trait][traitIds[index]] = names[index];\r\n    }\r\n  }\r\n\r\n  function setTraitSvgs1(uint8 trait1, uint8[] calldata trait1Ids, address source) external onlyOwner {\r\n    for (uint256 index = 0; index < trait1Ids.length; index++) {\r\n        traitSvgs1[trait1][trait1Ids[index]] = source; \r\n    }\r\n  }\r\n\r\n  function setTraitSvgs2(uint8 trait1, uint8 id1, uint8 trait2, uint8[] calldata trait2Ids, address source) external onlyOwner {\r\n    for (uint256 index = 0; index < trait2Ids.length; index++) {\r\n        traitSvgs2[trait1][id1][trait2][trait2Ids[index]] = source; \r\n    }\r\n  }\r\n\r\n  /*///////////////////////////////////////////////////////////////\r\n                  INTERNAL FUNCTIONS\r\n  //////////////////////////////////////////////////////////////*/\r\n\r\n  function call(address source, bytes memory sig) internal view returns (string memory svg) {\r\n      (bool succ, bytes memory ret)  = source.staticcall(sig);\r\n      require(succ, \"failed to get data\");\r\n      svg = abi.decode(ret, (string));\r\n  }\r\n\r\n  function _getSvgTopTalents(uint8 topTalentNo_) internal view returns (string memory data_) {\r\n    string memory s = string(abi.encodePacked(\"image\",\"()\"));\r\n    data_ = call(sourceTopTalents[topTalentNo_-1], abi.encodeWithSignature(s, \"\"));\r\n  }\r\n\r\n  function _getSvg1(uint8 trait1, uint8 id1, string memory sig_) internal view returns (string memory data_) {\r\n    string memory s = string(abi.encodePacked(sig_, \"()\"));\r\n    address source = traitSvgs1[trait1][id1];\r\n    data_ = call(source, abi.encodeWithSignature(s, \"\"));\r\n  }\r\n\r\n  function _getSvg2(uint8 trait1, uint8 id1, uint8 trait2, uint8 id2, string memory sig_) internal view returns (string memory data_) {\r\n    string memory s = string(abi.encodePacked(sig_, \"()\"));\r\n    address source = traitSvgs2[trait1][id1][trait2][id2];\r\n    data_ = call(source, abi.encodeWithSignature(s, \"\"));\r\n  }\r\n\r\n  // function _getData(uint8 trait1, uint8 id1, uint8 trait2, uint8 id2) internal view returns (bytes memory data) {\r\n  //   string memory s = string(abi.encodePacked(\r\n  //         traitTypes[trait1],toString(id1),\r\n  //         traitTypes[trait2],toString(id2),\r\n  //         \"()\"\r\n  //     ));\r\n  //   return abi.encodeWithSignature(s, \"\");\r\n  // }\r\n\r\n  function drawSVG(uint256 tokenId) public view returns (string memory) {\r\n    ICommoner.Commoner memory s = commoner.getTokenTraits(tokenId);\r\n\r\n    bool isMale_ = s.bodyType == 0;\r\n\r\n    return string(abi.encodePacked(\r\n      string(abi.encodePacked(\r\n        '<svg id=\"doge\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 64 64\" shape-rendering=\"geometricPrecision\" text-rendering=\"geometricPrecision\"><style>:root {',\r\n        // '--p:#ECE2D6;--s:#DDDEDB;--t:#52230F;',\r\n        /* Color */\r\n        _getSvg2(\r\n          0,\r\n          s.breed,\r\n          2,\r\n          s.palette,\r\n          string(abi.encodePacked(\"breed\", toString(s.breed), \"color\", s.palette))\r\n        ),\r\n        '}.p {fill: var(--p)!important;}.s {fill: var(--s)!important;}.t, .sf{fill: var(--t);}.st {fill:none;stroke-width:.6;}.sm, .hs, .ss{fill:none;stroke-width:.5;}.w, .hf{fill: #fff;}.to {fill: #E2B0D0;}.hs,.ss,.hf{opacity:.3;}.sf{opacity:.2;}.hs{stroke: #fff;}.st,.ss, .sm{stroke: var(--t);}.e{fill:#000;opacity:.5;}.n{fill:#000;opacity:.2;};</style><g stroke-linecap=\"round\" stroke-linejoin=\"round\" >',\r\n        /* BG */\r\n        _getSvg1(\r\n          0, \r\n          s.background,\r\n          string(abi.encodePacked(\"background\", toString(s.background)))\r\n        ),\r\n        /* Clothes (A/B) */\r\n        _getSvg1(\r\n          isMale_ ? 1 : 2,\r\n          s.clothes, \r\n          isMale_ ? \r\n            string(abi.encodePacked(\"clothes\", toString(s.clothes), \"a\")) :\r\n            string(abi.encodePacked(\"clothes\", toString(s.clothes), \"b\"))\r\n        )\r\n      )),\r\n      /* Head (A/B) */\r\n        _getSvg2(\r\n          0,\r\n          s.breed,\r\n          isMale_ ? 0 : 1,\r\n          s.head,\r\n          isMale_ ? \r\n            string(abi.encodePacked(\"breed\", toString(s.breed), \"head\", s.head, \"a\")) :\r\n            string(abi.encodePacked(\"breed\", toString(s.breed), \"head\", s.head, \"b\"))\r\n        ),\r\n      /* Hat (A/B) */\r\n      _getSvg1(\r\n        isMale_ ? 3 : 4,\r\n        s.accessory,\r\n        isMale_ ? \r\n            string(abi.encodePacked(\"hat\", toString(s.accessory), \"a\")) :\r\n            string(abi.encodePacked(\"hat\", toString(s.accessory), \"b\"))\r\n      ),\r\n      '</svg>'\r\n    ));\r\n  }\r\n\r\n  /**\r\n   * generates an attribute for the attributes array in the ERC721 metadata standard\r\n   * @param traitType the trait type to reference as the metadata key\r\n   * @param value the token's trait associated with the key\r\n   * @return a JSON dictionary for the single attribute\r\n   */\r\n  function attributeForTypeAndValue(string memory traitType, string memory value) internal pure returns (string memory) {\r\n    return string(abi.encodePacked(\r\n      '{\"trait_type\":\"',\r\n      traitType,\r\n      '\",\"value\":\"',\r\n      value,\r\n      '\"}'\r\n    ));\r\n  }\r\n\r\n  function toString(uint256 value) internal pure returns (string memory) {\r\n      // Inspired by OraclizeAPI's implementation - MIT licence\r\n      // https://github.com/oraclize/ethereum-api/blob/b42146b063c7d6ee1358846c198246239e9360e8/oraclizeAPI_0.4.25.sol\r\n\r\n      if (value == 0) {\r\n          return \"0\";\r\n      }\r\n      uint256 temp = value;\r\n      uint256 digits;\r\n      while (temp != 0) {\r\n          digits++;\r\n          temp /= 10;\r\n      }\r\n      bytes memory buffer = new bytes(digits);\r\n      while (value != 0) {\r\n          digits -= 1;\r\n          buffer[digits] = bytes1(uint8(48 + uint256(value % 10)));\r\n          value /= 10;\r\n      }\r\n      return string(buffer);\r\n  }\r\n\r\n  /**\r\n   * generates an array composed of all the individual traits and values\r\n   * @param tokenId the ID of the token to compose the metadata for\r\n   * @return a JSON array of all of the attributes for given token ID\r\n   */\r\n  function compileAttributes(uint256 tokenId) public view returns (string memory) {\r\n    ICommoner.Commoner memory s = commoner.getTokenTraits(tokenId);\r\n    // 'head': 0, \r\n    // 'breed': 1, \r\n    // 'palette': 2, \r\n    // 'bodyType': 3, \r\n    // 'clothes': 4, \r\n    // 'accessory A': 5, \r\n    // 'accessory B': 6, \r\n    // 'background': 7, \r\n    // 'smithing', 'alchemy', 'cooking'];\r\n    bool isMale_ = s.bodyType == 0;\r\n    string memory traits1 = string(abi.encodePacked(\r\n      attributeForTypeAndValue(traitTypes[0], traitNames[0][s.head]),',',\r\n      attributeForTypeAndValue(traitTypes[1], traitNames[1][s.breed]),',',\r\n      attributeForTypeAndValue(traitTypes[2], traitNames[2][s.palette]),',',\r\n      attributeForTypeAndValue(traitTypes[3], traitNames[3][s.bodyType]),',',\r\n      attributeForTypeAndValue(traitTypes[4], traitNames[4][s.clothes]),','\r\n    ));\r\n\r\n    string memory traits2 = string(abi.encodePacked(\r\n      attributeForTypeAndValue(traitTypes[5], isMale_ ? traitNames[5][s.accessory] : traitNames[6][s.accessory]),',',\r\n      attributeForTypeAndValue(traitTypes[6], traitNames[7][s.background]),',',\r\n      abi.encodePacked('{\"trait_type\":\"',traitTypes[7],'\",\"value\":',toString(s.smithing),'},'),\r\n      abi.encodePacked('{\"trait_type\":\"',traitTypes[8],'\",\"value\":',toString(s.alchemy),'},'),\r\n      abi.encodePacked('{\"trait_type\":\"',traitTypes[9],'\",\"value\":',toString(s.cooking),'},')\r\n    ));\r\n    return string(abi.encodePacked(\r\n      '[',\r\n      traits1,\r\n      traits2,\r\n      ']'\r\n    ));\r\n  }\r\n\r\n  /**\r\n   * generates a base64 encoded metadata response without referencing off-chain content\r\n   * @param tokenId the ID of the token to generate the metadata for\r\n   * @return a base64 encoded JSON dictionary of the token's metadata and SVG\r\n   */\r\n  function tokenURI(uint256 tokenId) public view override returns (string memory) {\r\n    string memory svgData = drawSVG(tokenId);\r\n\r\n    string memory metadata = string(abi.encodePacked(\r\n      '{\"name\": \"Commoner #',\r\n      tokenId.toString(),\r\n      '\", \"description\": \"100% on-chain\", \"image\": \"data:image/svg+xml;base64,',\r\n      base64(bytes(svgData)),\r\n      '\", \"attributes\":',\r\n      compileAttributes(tokenId),\r\n      \"}\"\r\n    ));\r\n\r\n    return string(abi.encodePacked(\r\n      \"data:application/json;base64,\",\r\n      base64(bytes(metadata))\r\n    ));\r\n  }\r\n\r\n  /** Not Revealed Traits */\r\n  function tokenURINotRevealed(uint256 tokenId) public view override returns (string memory) {\r\n    return notRevealedUri;\r\n  }\r\n\r\n  /** Top Talents Traits */\r\n  function tokenURITopTalents(uint8 topTalentNo, uint256 tokenId) public view override returns (string memory) {\r\n    string memory metadata = string(abi.encodePacked(\r\n      '{\"name\": \"Commoner #',\r\n      tokenId.toString(),\r\n      '\", \"description\": \"100% on-chain\", \"image\": \"data:image/svg+xml;base64,',\r\n      base64(bytes(_getSvgTopTalents(topTalentNo))),\r\n      '\", \"attributes\":',\r\n      _compileAttributesTalents(topTalentNo),\r\n      \"}\"\r\n    ));\r\n\r\n    return string(abi.encodePacked(\r\n      \"data:application/json;base64,\",\r\n      base64(bytes(metadata))\r\n    ));\r\n  }\r\n\r\n  function _compileAttributesTalents(uint8 topTalentNo_) internal pure returns (string memory) {\r\n    // ['head', 'breed', 'palette', 'bodyType', 'clothes', 'accessory', 'background', 'smithing', 'alchemy', 'cooking']\r\n    if(topTalentNo_ == 1) {\r\n      // Rudy Hammerpaw, Master Blacksmith\r\n      //     uint8 head; Determined\r\n      //     uint8 breed; Pitbull\r\n      //     uint8 palette; 1\r\n      //     uint8 bodyType; A\r\n      //     uint8 clothes; Rudy's Smithing Apron\r\n      //     uint8 accessory; Rudy's Eye Patch\r\n      //     uint8 background; The Forge\r\n      string memory traits1 = string(abi.encodePacked(\r\n        attributeForTypeAndValue('top talent', 'Rudy Hammerpaw, Master Blacksmith'),',',\r\n        attributeForTypeAndValue('head', 'Determined'),',',\r\n        attributeForTypeAndValue('breed', 'Pitbull'),',',\r\n        attributeForTypeAndValue('palette', 'Palette 1'),',',\r\n        attributeForTypeAndValue('bodyType', 'A (Male)'),',',\r\n        attributeForTypeAndValue('clothes', \"Rudy's Smithing Apron\"),',',\r\n        attributeForTypeAndValue('accessory', \"Rudy's Eye Patch\"),',',\r\n        attributeForTypeAndValue('background', 'The Forge')\r\n      ));\r\n      return string(abi.encodePacked(\r\n        '[',\r\n        traits1,\r\n        ']'\r\n      ));\r\n    }\r\n    if(topTalentNo_ == 2) {\r\n      // Catharine Von Schbeagle, Savant of Science\r\n      //     uint8 head; Excited\r\n      //     uint8 breed; Beagle\r\n      //     uint8 palette; 1\r\n      //     uint8 bodyType; A\r\n      //     uint8 clothes; Goggles of Science\r\n      //     uint8 accessory; Von Schbeagle's Lab Coat\r\n      //     uint8 background; Artificer's Lab\r\n      string memory traits1 = string(abi.encodePacked(\r\n        attributeForTypeAndValue('top talent', 'Catharine Von Schbeagle, Savant of Science'),',',\r\n        attributeForTypeAndValue('head', 'Excited'),',',\r\n        attributeForTypeAndValue('breed', 'Beagle'),',',\r\n        attributeForTypeAndValue('palette', 'Palette 1'),',',\r\n        attributeForTypeAndValue('bodyType', 'A (Male)'),',',\r\n        attributeForTypeAndValue('clothes', \"Goggles of Science\"),',',\r\n        attributeForTypeAndValue('accessory', \"Von Schbeagle's Lab Coat\"),',',\r\n        attributeForTypeAndValue('background', \"Artificer's Lab\")\r\n      ));\r\n      return string(abi.encodePacked(\r\n        '[',\r\n        traits1,\r\n        ']'\r\n      ));\r\n    }\r\n    if(topTalentNo_ == 3) {\r\n      // Charlie Chonkins, Royal Cook\r\n      //     uint8 head; Content\r\n      //     uint8 breed; Corgi\r\n      //     uint8 palette; 1\r\n      //     uint8 bodyType; A\r\n      //     uint8 clothes; Royal Chef's Apron\r\n      //     uint8 accessory; Royal Chef's Hat\r\n      //     uint8 background; The Mess Hall\r\n      string memory traits1 = string(abi.encodePacked(\r\n        attributeForTypeAndValue('top talent', 'Charlie Chonkins, Royal Cook'),',',\r\n        attributeForTypeAndValue('head', 'Content'),',',\r\n        attributeForTypeAndValue('breed', 'Corgi'),',',\r\n        attributeForTypeAndValue('palette', 'Palette 1'),',',\r\n        attributeForTypeAndValue('bodyType', 'A (Male)'),',',\r\n        attributeForTypeAndValue('clothes', \"Royal Chef's Apron\"),',',\r\n        attributeForTypeAndValue('accessory', \"Royal Chef's Hat\"),',',\r\n        attributeForTypeAndValue('background', 'The Mess Hall')\r\n      ));\r\n      return string(abi.encodePacked(\r\n        '[',\r\n        traits1,\r\n        ']'\r\n      ));\r\n    }\r\n    if(topTalentNo_ == 4) {\r\n      // Prince Pom, Prince of Dogewood Kingdom\r\n      //     uint8 head; Proud\r\n      //     uint8 breed; Pomeranian\r\n      //     uint8 palette; 1\r\n      //     uint8 bodyType; A\r\n      //     uint8 clothes; Coat of the Strategist\r\n      //     uint8 accessory; Dogewood Royal Scepter\r\n      //     uint8 background; The War Room\r\n      string memory traits1 = string(abi.encodePacked(\r\n        attributeForTypeAndValue('top talent', 'Prince Pom, Prince of Dogewood Kingdom'),',',\r\n        attributeForTypeAndValue('head', 'Proud'),',',\r\n        attributeForTypeAndValue('breed', 'Pomeranian'),',',\r\n        attributeForTypeAndValue('palette', 'Palette 1'),',',\r\n        attributeForTypeAndValue('bodyType', 'A (Male)'),',',\r\n        attributeForTypeAndValue('clothes', \"Coat of the Strategist\"),',',\r\n        attributeForTypeAndValue('accessory', \"Dogewood Royal Scepter\"),',',\r\n        attributeForTypeAndValue('background', 'The War Room')\r\n      ));\r\n      return string(abi.encodePacked(\r\n        '[',\r\n        traits1,\r\n        ']'\r\n      ));\r\n    }\r\n    return string(abi.encodePacked(\r\n      '[]'\r\n    ));\r\n  }\r\n\r\n  /** BASE 64 - Written by Brech Devos */\r\n\r\n  function base64(bytes memory data) internal pure returns (string memory) {\r\n    if (data.length == 0) return '';\r\n    \r\n    // load the table into memory\r\n    string memory table = TABLE;\r\n\r\n    // multiply by 4/3 rounded up\r\n    uint256 encodedLen = 4 * ((data.length + 2) / 3);\r\n\r\n    // add some extra buffer at the end required for the writing\r\n    string memory result = new string(encodedLen + 32);\r\n\r\n    assembly {\r\n      // set the actual output length\r\n      mstore(result, encodedLen)\r\n      \r\n      // prepare the lookup table\r\n      let tablePtr := add(table, 1)\r\n      \r\n      // input ptr\r\n      let dataPtr := data\r\n      let endPtr := add(dataPtr, mload(data))\r\n      \r\n      // result ptr, jump over length\r\n      let resultPtr := add(result, 32)\r\n      \r\n      // run over the input, 3 bytes at a time\r\n      for {} lt(dataPtr, endPtr) {}\r\n      {\r\n          dataPtr := add(dataPtr, 3)\r\n          \r\n          // read 3 bytes\r\n          let input := mload(dataPtr)\r\n          \r\n          // write 4 characters\r\n          mstore(resultPtr, shl(248, mload(add(tablePtr, and(shr(18, input), 0x3F)))))\r\n          resultPtr := add(resultPtr, 1)\r\n          mstore(resultPtr, shl(248, mload(add(tablePtr, and(shr(12, input), 0x3F)))))\r\n          resultPtr := add(resultPtr, 1)\r\n          mstore(resultPtr, shl(248, mload(add(tablePtr, and(shr( 6, input), 0x3F)))))\r\n          resultPtr := add(resultPtr, 1)\r\n          mstore(resultPtr, shl(248, mload(add(tablePtr, and(        input,  0x3F)))))\r\n          resultPtr := add(resultPtr, 1)\r\n      }\r\n      \r\n      // padding with '='\r\n      switch mod(mload(data), 3)\r\n      case 1 { mstore(sub(resultPtr, 2), shl(240, 0x3d3d)) }\r\n      case 2 { mstore(sub(resultPtr, 1), shl(248, 0x3d)) }\r\n    }\r\n    \r\n    return result;\r\n  }\r\n}", "ABI": "[{\"inputs\":[],\"name\":\"admin\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"commoner\",\"outputs\":[{\"internalType\":\"contract ICommoner\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"tokenId\",\"type\":\"uint256\"}],\"name\":\"compileAttributes\",\"outputs\":[{\"internalType\":\"string\",\"name\":\"\",\"type\":\"string\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"tokenId\",\"type\":\"uint256\"}],\"name\":\"drawSVG\",\"outputs\":[{\"internalType\":\"string\",\"name\":\"\",\"type\":\"string\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"initialize\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"notRevealedUri\",\"outputs\":[{\"internalType\":\"string\",\"name\":\"\",\"type\":\"string\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"revealed\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"_commoner\",\"type\":\"address\"}],\"name\":\"setCommoner\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"string\",\"name\":\"uri_\",\"type\":\"string\"}],\"name\":\"setNotRevealedUri\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"bool\",\"name\":\"revealed_\",\"type\":\"bool\"}],\"name\":\"setRevealed\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address[4]\",\"name\":\"source_\",\"type\":\"address[4]\"}],\"name\":\"setSourceTopTalents\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint8\",\"name\":\"trait\",\"type\":\"uint8\"},{\"internalType\":\"uint8[]\",\"name\":\"traitIds\",\"type\":\"uint8[]\"},{\"internalType\":\"string[]\",\"name\":\"names\",\"type\":\"string[]\"}],\"name\":\"setTraitNames\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint8\",\"name\":\"trait1\",\"type\":\"uint8\"},{\"internalType\":\"uint8[]\",\"name\":\"trait1Ids\",\"type\":\"uint8[]\"},{\"internalType\":\"address\",\"name\":\"source\",\"type\":\"address\"}],\"name\":\"setTraitSvgs1\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint8\",\"name\":\"trait1\",\"type\":\"uint8\"},{\"internalType\":\"uint8\",\"name\":\"id1\",\"type\":\"uint8\"},{\"internalType\":\"uint8\",\"name\":\"trait2\",\"type\":\"uint8\"},{\"internalType\":\"uint8[]\",\"name\":\"trait2Ids\",\"type\":\"uint8[]\"},{\"internalType\":\"address\",\"name\":\"source\",\"type\":\"address\"}],\"name\":\"setTraitSvgs2\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint8[]\",\"name\":\"ids_\",\"type\":\"uint8[]\"},{\"internalType\":\"string[]\",\"name\":\"values_\",\"type\":\"string[]\"}],\"name\":\"setTraitTypes\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"name\":\"sourceTopTalents\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"tokenId\",\"type\":\"uint256\"}],\"name\":\"tokenURI\",\"outputs\":[{\"internalType\":\"string\",\"name\":\"\",\"type\":\"string\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"tokenId\",\"type\":\"uint256\"}],\"name\":\"tokenURINotRevealed\",\"outputs\":[{\"internalType\":\"string\",\"name\":\"\",\"type\":\"string\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint8\",\"name\":\"topTalentNo\",\"type\":\"uint8\"},{\"internalType\":\"uint256\",\"name\":\"tokenId\",\"type\":\"uint256\"}],\"name\":\"tokenURITopTalents\",\"outputs\":[{\"internalType\":\"string\",\"name\":\"\",\"type\":\"string\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint8\",\"name\":\"\",\"type\":\"uint8\"},{\"internalType\":\"uint8\",\"name\":\"\",\"type\":\"uint8\"}],\"name\":\"traitNames\",\"outputs\":[{\"internalType\":\"string\",\"name\":\"\",\"type\":\"string\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint8\",\"name\":\"\",\"type\":\"uint8\"},{\"internalType\":\"uint8\",\"name\":\"\",\"type\":\"uint8\"}],\"name\":\"traitSvgs1\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint8\",\"name\":\"\",\"type\":\"uint8\"},{\"internalType\":\"uint8\",\"name\":\"\",\"type\":\"uint8\"},{\"internalType\":\"uint8\",\"name\":\"\",\"type\":\"uint8\"},{\"internalType\":\"uint8\",\"name\":\"\",\"type\":\"uint8\"}],\"name\":\"traitSvgs2\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint8\",\"name\":\"\",\"type\":\"uint8\"}],\"name\":\"traitTypes\",\"outputs\":[{\"internalType\":\"string\",\"name\":\"\",\"type\":\"string\"}],\"stateMutability\":\"view\",\"type\":\"function\"}]", "ContractName": "TraitsCommoners", "CompilerVersion": "v0.8.7+commit.e28d00a7", "OptimizationUsed": "1", "Runs": "200", "ConstructorArguments": "", "EVMVersion": "Default", "Library": "", "LicenseType": "Unlicense", "Proxy": "0", "Implementation": "", "SwarmSource": "ipfs://5eed4cd7a734d04f4cc34fac7f22c11fbc785a4fe130d134a2e329a380c1f11b"}]}