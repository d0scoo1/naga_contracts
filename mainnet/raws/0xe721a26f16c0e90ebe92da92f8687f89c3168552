{"status": "1", "message": "OK", "result": [{"SourceCode": "// SPDX-License-Identifier: GPL-3.0\r\npragma solidity ^0.8;\r\n\r\ncontract ERC721PermitEverywhere {\r\n    struct PermitTransferFrom {\r\n        IERC721 token;\r\n        address spender;\r\n        uint256 tokenId;\r\n        bool allowAnyTokenId;\r\n        uint256 deadline;\r\n    }\r\n\r\n    struct Signature {\r\n        bytes32 r;\r\n        bytes32 s;\r\n        uint8 v;\r\n    }\r\n\r\n    bytes32 public immutable DOMAIN_SEPARATOR;\r\n    bytes32 public immutable TRANSFER_PERMIT_TYPEHASH;\r\n\r\n    // Owner -> current nonce.\r\n    mapping (address => uint256) public currentNonce;\r\n\r\n    constructor() {\r\n        uint256 chainId;\r\n        assembly { chainId := chainid() }\r\n        DOMAIN_SEPARATOR = keccak256(abi.encode(\r\n            keccak256('EIP712Domain(string name,string version,uint256 chainId,address verifyingContract)'),\r\n            keccak256(bytes('ERC721PermitEverywhere')),\r\n            keccak256(bytes('1.0.0')),\r\n            chainId,\r\n            address(this)\r\n        ));\r\n        TRANSFER_PERMIT_TYPEHASH =\r\n            keccak256('PermitTransferFrom(address token,address spender,uint256 tokenId,bool allowAnyTokenId,uint256 deadline,uint256 nonce)');\r\n    }\r\n\r\n    function executePermitTransferFrom(\r\n        address owner,\r\n        address to,\r\n        uint256 tokenId,\r\n        PermitTransferFrom memory permit,\r\n        Signature memory sig\r\n    )\r\n        external\r\n    {\r\n        _consumePermit(owner, tokenId, permit, sig);\r\n        permit.token.transferFrom(owner, to, tokenId);\r\n    }\r\n\r\n    function executePermitSafeTransferFrom(\r\n        address owner,\r\n        address to,\r\n        uint256 tokenId,\r\n        bytes memory data,\r\n        PermitTransferFrom memory permit,\r\n        Signature memory sig\r\n    )\r\n        external\r\n    {\r\n        _consumePermit(owner, tokenId, permit, sig);\r\n        permit.token.safeTransferFrom(owner, to, tokenId, data);\r\n    }\r\n\r\n    function hashPermit(PermitTransferFrom memory permit, uint256 nonce)\r\n        public\r\n        view\r\n        returns (bytes32 h)\r\n    {\r\n        bytes32 dh = DOMAIN_SEPARATOR;\r\n        bytes32 th = TRANSFER_PERMIT_TYPEHASH;\r\n        assembly {\r\n            if lt(permit, 0x20)  {\r\n                invalid()\r\n            }\r\n            let c1 := mload(sub(permit, 0x20))\r\n            let c2 := mload(add(permit, 0xA0))\r\n            mstore(sub(permit, 0x20), th)\r\n            mstore(add(permit, 0xA0), nonce)\r\n            let ph := keccak256(sub(permit, 0x20), 0xE0)\r\n            mstore(sub(permit, 0x20), c1)\r\n            mstore(add(permit, 0xA0), c2)\r\n            let p:= mload(0x40)\r\n            mstore(p, 0x1901000000000000000000000000000000000000000000000000000000000000)\r\n            mstore(add(p, 0x02), dh)\r\n            mstore(add(p, 0x22), ph)\r\n            h := keccak256(p, 0x42)\r\n        }\r\n    }\r\n\r\n    function _consumePermit(\r\n        address owner,\r\n        uint256 tokenId,\r\n        PermitTransferFrom memory permit,\r\n        Signature memory sig\r\n    )\r\n        private\r\n    {\r\n        require(msg.sender == permit.spender, 'SPENDER_NOT_PERMITTED');\r\n        require(permit.allowAnyTokenId || permit.tokenId == tokenId, 'TOKEN_ID_NOT_PERMITTED');\r\n        require(permit.deadline >= block.timestamp, 'PERMIT_EXPIRED');\r\n        uint256 nonce = currentNonce[owner]++;\r\n        require(owner == getSigner(hashPermit(permit, nonce), sig), 'INVALID_SIGNER');\r\n    }\r\n\r\n    function getSigner(bytes32 hash, Signature memory sig) private pure returns (address signer) {\r\n        signer = ecrecover(hash, sig.v, sig.r, sig.s);\r\n        require(signer != address(0), 'INVALID_SIGNATURE');\r\n    }\r\n}\r\n\r\ninterface IERC721 {\r\n    function ownerOf(uint256 tokenId) external view returns (address);\r\n    function approve(address spender, uint256 amount) external;\r\n    function transferFrom(address owner, address to, uint256 tokenId) external;\r\n    function safeTransferFrom(address owner, address to, uint256 tokenId, bytes memory data) external;\r\n}", "ABI": "[{\"inputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"constructor\"},{\"inputs\":[],\"name\":\"DOMAIN_SEPARATOR\",\"outputs\":[{\"internalType\":\"bytes32\",\"name\":\"\",\"type\":\"bytes32\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"TRANSFER_PERMIT_TYPEHASH\",\"outputs\":[{\"internalType\":\"bytes32\",\"name\":\"\",\"type\":\"bytes32\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"name\":\"currentNonce\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"owner\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"to\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"tokenId\",\"type\":\"uint256\"},{\"internalType\":\"bytes\",\"name\":\"data\",\"type\":\"bytes\"},{\"components\":[{\"internalType\":\"contract IERC721\",\"name\":\"token\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"spender\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"tokenId\",\"type\":\"uint256\"},{\"internalType\":\"bool\",\"name\":\"allowAnyTokenId\",\"type\":\"bool\"},{\"internalType\":\"uint256\",\"name\":\"deadline\",\"type\":\"uint256\"}],\"internalType\":\"struct ERC721PermitEverywhere.PermitTransferFrom\",\"name\":\"permit\",\"type\":\"tuple\"},{\"components\":[{\"internalType\":\"bytes32\",\"name\":\"r\",\"type\":\"bytes32\"},{\"internalType\":\"bytes32\",\"name\":\"s\",\"type\":\"bytes32\"},{\"internalType\":\"uint8\",\"name\":\"v\",\"type\":\"uint8\"}],\"internalType\":\"struct ERC721PermitEverywhere.Signature\",\"name\":\"sig\",\"type\":\"tuple\"}],\"name\":\"executePermitSafeTransferFrom\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"owner\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"to\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"tokenId\",\"type\":\"uint256\"},{\"components\":[{\"internalType\":\"contract IERC721\",\"name\":\"token\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"spender\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"tokenId\",\"type\":\"uint256\"},{\"internalType\":\"bool\",\"name\":\"allowAnyTokenId\",\"type\":\"bool\"},{\"internalType\":\"uint256\",\"name\":\"deadline\",\"type\":\"uint256\"}],\"internalType\":\"struct ERC721PermitEverywhere.PermitTransferFrom\",\"name\":\"permit\",\"type\":\"tuple\"},{\"components\":[{\"internalType\":\"bytes32\",\"name\":\"r\",\"type\":\"bytes32\"},{\"internalType\":\"bytes32\",\"name\":\"s\",\"type\":\"bytes32\"},{\"internalType\":\"uint8\",\"name\":\"v\",\"type\":\"uint8\"}],\"internalType\":\"struct ERC721PermitEverywhere.Signature\",\"name\":\"sig\",\"type\":\"tuple\"}],\"name\":\"executePermitTransferFrom\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"components\":[{\"internalType\":\"contract IERC721\",\"name\":\"token\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"spender\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"tokenId\",\"type\":\"uint256\"},{\"internalType\":\"bool\",\"name\":\"allowAnyTokenId\",\"type\":\"bool\"},{\"internalType\":\"uint256\",\"name\":\"deadline\",\"type\":\"uint256\"}],\"internalType\":\"struct ERC721PermitEverywhere.PermitTransferFrom\",\"name\":\"permit\",\"type\":\"tuple\"},{\"internalType\":\"uint256\",\"name\":\"nonce\",\"type\":\"uint256\"}],\"name\":\"hashPermit\",\"outputs\":[{\"internalType\":\"bytes32\",\"name\":\"h\",\"type\":\"bytes32\"}],\"stateMutability\":\"view\",\"type\":\"function\"}]", "ContractName": "ERC721PermitEverywhere", "CompilerVersion": "v0.8.15+commit.e14f2714", "OptimizationUsed": "1", "Runs": "200", "ConstructorArguments": "", "EVMVersion": "Default", "Library": "", "LicenseType": "GNU GPLv3", "Proxy": "0", "Implementation": "", "SwarmSource": "ipfs://4ad7aa2c76ee6afa1728c360024d3deeeb26ec249f6440e203abdf06f32abfc2"}]}